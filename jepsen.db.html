<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.db documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.3.6</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.clj-ssh.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-ssh</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.docker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>docker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.k8s.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>k8s</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.retry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>retry</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.scp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scp</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.sshj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sshj</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch current"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2 branch"><a href="jepsen.fs-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fs-cache</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.interpreter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpreter</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-3"><a href="jepsen.generator.translation-table.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>translation-table</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2 branch"><a href="jepsen.lazyfs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazyfs</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.membership.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>membership</span></div></a></li><li class="depth-4"><a href="jepsen.nemesis.membership.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2 branch"><a href="jepsen.role.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>role</span></div></a></li><li class="depth-2"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-3 branch"><a href="jepsen.store.format.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format</span></div></a></li><li class="depth-3"><a href="jepsen.store.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4 branch"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.wr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wr</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.kafka.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>kafka</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -331px;"><span class="top" style="height: 340px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.db.html#var-cycle.21"><div class="inner"><span>cycle!</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-cycle-tries"><div class="inner"><span>cycle-tries</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-DB"><div class="inner"><span>DB</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html#var-setup.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>setup!</span></div></a></li><li class="depth-2"><a href="jepsen.db.html#var-teardown.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>teardown!</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-Kill"><div class="inner"><span>Kill</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html#var-kill.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kill!</span></div></a></li><li class="depth-2"><a href="jepsen.db.html#var-start.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>start!</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-log-files-map"><div class="inner"><span>log-files-map</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-LogFiles"><div class="inner"><span>LogFiles</span></div></a></li><li class="depth-2"><a href="jepsen.db.html#var-log-files"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log-files</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-map-test"><div class="inner"><span>map-test</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-noop"><div class="inner"><span>noop</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-Pause"><div class="inner"><span>Pause</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html#var-pause.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pause!</span></div></a></li><li class="depth-2"><a href="jepsen.db.html#var-resume.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>resume!</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-Primary"><div class="inner"><span>Primary</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html#var-primaries"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>primaries</span></div></a></li><li class="depth-2"><a href="jepsen.db.html#var-setup-primary.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>setup-primary!</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-Process"><div class="inner"><span>Process</span></div></a></li><li class="depth-1"><a href="jepsen.db.html#var-tcpdump"><div class="inner"><span>tcpdump</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.db</h1><div class="doc"><div class="markdown"><p>Allows Jepsen to set up and tear down databases.</p>
</div></div><div class="public anchor" id="var-cycle.21"><h3>cycle!</h3><div class="usage"><code>(cycle! test)</code></div><div class="doc"><div class="markdown"><p>Takes a test, and tears down, then sets up, the database on all nodes concurrently.</p>
<p>If any call to setup! or setup-primary! throws :type ::setup-failed, we tear down and retry the whole process up to <code>cycle-tries</code> times.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L162">view source</a></div></div><div class="public anchor" id="var-cycle-tries"><h3>cycle-tries</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>How many tries do we get to set up a database?</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L158">view source</a></div></div><div class="public anchor" id="var-DB"><h3>DB</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-setup.21"><h3>setup!</h3><div class="usage"><code>(setup! db test node)</code></div><div class="doc"><div class="markdown"><p>Set up the database on this particular node.</p>
</div></div></div><div class="public anchor" id="var-teardown.21"><h3>teardown!</h3><div class="usage"><code>(teardown! db test node)</code></div><div class="doc"><div class="markdown"><p>Tear down the database on this particular node.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L12">view source</a></div></div><div class="public anchor" id="var-Kill"><h3>Kill</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>This optional protocol supports starting and killing a DB’s processes.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-kill.21"><h3>kill!</h3><div class="usage"><code>(kill! db test node)</code></div><div class="doc"><div class="markdown"><p>Forcibly kills the process</p>
</div></div></div><div class="public anchor" id="var-start.21"><h3>start!</h3><div class="usage"><code>(start! db test node)</code></div><div class="doc"><div class="markdown"><p>Starts the process</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L16">view source</a></div></div><div class="public anchor" id="var-log-files-map"><h3>log-files-map</h3><div class="usage"><code>(log-files-map db test node)</code></div><div class="doc"><div class="markdown"><p>Takes a DB, a test, and a node. Returns a map of remote paths to local paths. Checks to make sure there are no duplicate local paths.</p>
<p>log-files used to return a sequence of remote paths, and some people are likely still assuming that form for composition. When they start e.g. concatenating maps into lists of strings, we’re going to get mixed representations. We try to make all this Just Work (TM).</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L50">view source</a></div></div><div class="public anchor" id="var-LogFiles"><h3>LogFiles</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-log-files"><h3>log-files</h3><div class="usage"><code>(log-files db test node)</code></div><div class="doc"><div class="markdown"><p>Returns either a.) a map of fully-qualified remote paths (on this DB node) to short local paths (in store/), or b.) a sequence of fully-qualified remote paths.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L44">view source</a></div></div><div class="public anchor" id="var-map-test"><h3>map-test</h3><div class="usage"><code>(map-test f db)</code></div><div class="doc"><div class="markdown"><p>Wraps a DB in another DB which rewrites every test argument using (f test). Helpful for when you want to compose two DBs together that need different test parameters, like :version.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L221">view source</a></div></div><div class="public anchor" id="var-noop"><h3>noop</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Does nothing.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L82">view source</a></div></div><div class="public anchor" id="var-Pause"><h3>Pause</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>This optional protocol supports pausing and resuming a DB’s processes.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-pause.21"><h3>pause!</h3><div class="usage"><code>(pause! db test node)</code></div><div class="doc"><div class="markdown"><p>Pauses the process</p>
</div></div></div><div class="public anchor" id="var-resume.21"><h3>resume!</h3><div class="usage"><code>(resume! db test node)</code></div><div class="doc"><div class="markdown"><p>Resumes the process</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L30">view source</a></div></div><div class="public anchor" id="var-Primary"><h3>Primary</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>This optional protocol supports databases which have a notion of one (or more) primary nodes.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-primaries"><h3>primaries</h3><div class="usage"><code>(primaries db test)</code></div><div class="doc"><div class="markdown"><p>Returns a collection of nodes which are currently primaries. Best-effort is OK; in practice, this usually devolves to ‘nodes that think they’re currently primaries’.</p>
</div></div></div><div class="public anchor" id="var-setup-primary.21"><h3>setup-primary!</h3><div class="usage"><code>(setup-primary! db test node)</code></div><div class="doc"><div class="markdown"><p>Performs one-time setup on a single node.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L35">view source</a></div></div><div class="public anchor" id="var-Process"><h3>Process</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L28">view source</a></div></div><div class="public anchor" id="var-tcpdump"><h3>tcpdump</h3><div class="usage"><code>(tcpdump opts)</code></div><div class="doc"><div class="markdown"><p>A database which runs a tcpdump capture from setup! to teardown!, and yields a <code>tcpdump</code> logfile. Options:</p>
<p>:clients-only?  If true, applies a filter string which yields only traffic from Jepsen clients, rather than capturing inter-DB-node traffic.</p>
<p>:filter A filter string to apply (in addition to ports). e.g. “host 192.168.122.1”, which can be helpful for seeing <em>just</em>             client traffic from the control node.</p>
<p>:ports  A collection of ports to grab traffic from.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/db.clj#L88">view source</a></div></div></div></body></html>