<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jepsen.nemesis documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jepsen</span> <span class="project-version">0.3.6</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jepsen</span></div></div></li><li class="depth-2 branch"><a href="jepsen.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-2"><a href="jepsen.checker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>checker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.clock.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clock</span></div></a></li><li class="depth-3 branch"><a href="jepsen.checker.perf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>perf</span></div></a></li><li class="depth-3"><a href="jepsen.checker.timeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timeline</span></div></a></li><li class="depth-2 branch"><a href="jepsen.cli.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>cli</span></div></a></li><li class="depth-2 branch"><a href="jepsen.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-2 branch"><a href="jepsen.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2"><a href="jepsen.control.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>control</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.clj-ssh.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-ssh</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.docker.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>docker</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.k8s.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>k8s</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.net.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.retry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>retry</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.scp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scp</span></div></a></li><li class="depth-3 branch"><a href="jepsen.control.sshj.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sshj</span></div></a></li><li class="depth-3"><a href="jepsen.control.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 branch"><a href="jepsen.core.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="jepsen.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2 branch"><a href="jepsen.faketime.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faketime</span></div></a></li><li class="depth-2 branch"><a href="jepsen.fs-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fs-cache</span></div></a></li><li class="depth-2"><a href="jepsen.generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generator</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.context.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>context</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.interpreter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interpreter</span></div></a></li><li class="depth-3 branch"><a href="jepsen.generator.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-3"><a href="jepsen.generator.translation-table.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>translation-table</span></div></a></li><li class="depth-2 branch"><a href="jepsen.independent.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>independent</span></div></a></li><li class="depth-2 branch"><a href="jepsen.lazyfs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazyfs</span></div></a></li><li class="depth-2 current"><a href="jepsen.nemesis.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nemesis</span></div></a></li><li class="depth-3 branch"><a href="jepsen.nemesis.combined.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>combined</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.membership.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>membership</span></div></a></li><li class="depth-4"><a href="jepsen.nemesis.membership.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-3"><a href="jepsen.nemesis.time.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>time</span></div></a></li><li class="depth-2"><a href="jepsen.net.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>net</span></div></a></li><li class="depth-3"><a href="jepsen.net.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-2"><a href="jepsen.os.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>os</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.centos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>centos</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.debian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debian</span></div></a></li><li class="depth-3 branch"><a href="jepsen.os.smartos.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smartos</span></div></a></li><li class="depth-3"><a href="jepsen.os.ubuntu.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ubuntu</span></div></a></li><li class="depth-2 branch"><a href="jepsen.reconnect.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>reconnect</span></div></a></li><li class="depth-2 branch"><a href="jepsen.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-2 branch"><a href="jepsen.report.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>report</span></div></a></li><li class="depth-2 branch"><a href="jepsen.role.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>role</span></div></a></li><li class="depth-2"><a href="jepsen.store.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-3 branch"><a href="jepsen.store.format.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format</span></div></a></li><li class="depth-3"><a href="jepsen.store.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2"><a href="jepsen.tests.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>tests</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.adya.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>adya</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.bank.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bank</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.causal-reverse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>causal-reverse</span></div></a></li><li class="depth-3"><a href="jepsen.tests.cycle.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cycle</span></div></a></li><li class="depth-4 branch"><a href="jepsen.tests.cycle.append.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>append</span></div></a></li><li class="depth-4"><a href="jepsen.tests.cycle.wr.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wr</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.kafka.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>kafka</span></div></a></li><li class="depth-3 branch"><a href="jepsen.tests.linearizable-register.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>linearizable-register</span></div></a></li><li class="depth-3"><a href="jepsen.tests.long-fork.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>long-fork</span></div></a></li><li class="depth-2 branch"><a href="jepsen.util.html"><div class="inner"><span class="tree" style="top: -331px;"><span class="top" style="height: 340px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="jepsen.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jepsen.nemesis.html#var-bisect"><div class="inner"><span>bisect</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-bitflip"><div class="inner"><span>bitflip</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-bitflip-dir"><div class="inner"><span>bitflip-dir</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-bridge"><div class="inner"><span>bridge</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-clock-scrambler"><div class="inner"><span>clock-scrambler</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-complete-grudge"><div class="inner"><span>complete-grudge</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-compose"><div class="inner"><span>compose</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-f-map"><div class="inner"><span>f-map</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-hammer-time"><div class="inner"><span>hammer-time</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-invert-grudge"><div class="inner"><span>invert-grudge</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-majorities-ring"><div class="inner"><span>majorities-ring</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-majorities-ring-perfect"><div class="inner"><span>majorities-ring-perfect</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-majorities-ring-stochastic"><div class="inner"><span>majorities-ring-stochastic</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-Nemesis"><div class="inner"><span>Nemesis</span></div></a></li><li class="depth-2 branch"><a href="jepsen.nemesis.html#var-invoke.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>invoke!</span></div></a></li><li class="depth-2 branch"><a href="jepsen.nemesis.html#var-setup.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>setup!</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html#var-teardown.21"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>teardown!</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-node-start-stopper"><div class="inner"><span>node-start-stopper</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-noop"><div class="inner"><span>noop</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-partition-halves"><div class="inner"><span>partition-halves</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-partition-majorities-ring"><div class="inner"><span>partition-majorities-ring</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-partition-random-halves"><div class="inner"><span>partition-random-halves</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-partition-random-node"><div class="inner"><span>partition-random-node</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-partitioner"><div class="inner"><span>partitioner</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-Reflection"><div class="inner"><span>Reflection</span></div></a></li><li class="depth-2"><a href="jepsen.nemesis.html#var-fs"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fs</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-set-time.21"><div class="inner"><span>set-time!</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-split-one"><div class="inner"><span>split-one</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-timeout"><div class="inner"><span>timeout</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-truncate-file"><div class="inner"><span>truncate-file</span></div></a></li><li class="depth-1"><a href="jepsen.nemesis.html#var-validate"><div class="inner"><span>validate</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jepsen.nemesis</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-bisect"><h3>bisect</h3><div class="usage"><code>(bisect coll)</code></div><div class="doc"><div class="markdown"><p>Given a sequence, cuts it in half; smaller half first.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L109">view source</a></div></div><div class="public anchor" id="var-bitflip"><h3>bitflip</h3><div class="usage"><code>(bitflip)</code></div><div class="doc"><div class="markdown"><p>A nemesis which introduces random bitflips in files. Takes operations like:</p>
<pre><code class="language-clj">{:f     :bitflip
 :value {"some-node" {:file         "/path/to/file or /path/to/dir"
                      :probability  1e-3}}}
</code></pre>
<p>This flips 1 x 10^-3 of the bits in <code>/path/to/file</code>, or a random file in <code>/path/to/dir</code>, on “some-node”.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L588">view source</a></div></div><div class="public anchor" id="var-bitflip-dir"><h3>bitflip-dir</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Where do we install the bitflip utility?</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L550">view source</a></div></div><div class="public anchor" id="var-bridge"><h3>bridge</h3><div class="usage"><code>(bridge nodes)</code></div><div class="doc"><div class="markdown"><p>A grudge which cuts the network in half, but preserves a node in the middle which has uninterrupted bidirectional connectivity to both components.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L145">view source</a></div></div><div class="public anchor" id="var-clock-scrambler"><h3>clock-scrambler</h3><div class="usage"><code>(clock-scrambler dt)</code></div><div class="doc"><div class="markdown"><p>Randomizes the system clock of all nodes within a dt-second window.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L436">view source</a></div></div><div class="public anchor" id="var-complete-grudge"><h3>complete-grudge</h3><div class="usage"><code>(complete-grudge components)</code></div><div class="doc"><div class="markdown"><p>Takes a collection of components (collections of nodes), and computes a grudge such that no node can talk to any nodes outside its partition.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L121">view source</a></div></div><div class="public anchor" id="var-compose"><h3>compose</h3><div class="usage"><code>(compose nemeses)</code></div><div class="doc"><div class="markdown"><p>Combines multiple Nemesis objects into one. If all, or all but one, nemesis support Reflection, compose can simply take a collection of nemeses, and use (fs nem) to figure out what ops to send to which nemesis. Otherwise…</p>
<p>Takes a map of fs to nemeses and returns a single nemesis which, depending on (:f op), routes to the appropriate child nemesis. <code>fs</code> should be a function which takes (:f op) and returns either nil, if that nemesis should not handle that :f, or a new :f, which replaces the op’s :f, and the resulting op is passed to the given nemesis. For instance:</p>
<pre><code>(compose {#{:start :stop} (partition-random-halves)
          #{:kill}        (process-killer)})
</code></pre>
<p>This routes <code>:kill</code> ops to process killer, and :start/:stop to the partitioner. What if we had two partitioners which <em>both</em> take :start/:stop?</p>
<pre><code>(compose {{:split-start :start
           :split-stop  :stop} (partition-random-halves)
          {:ring-start  :start
           :ring-stop2  :stop} (partition-majorities-ring)})
</code></pre>
<p>We turn :split-start into :start, and pass that op to partition-random-halves.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L385">view source</a></div></div><div class="public anchor" id="var-f-map"><h3>f-map</h3><div class="usage"><code>(f-map lift nem)</code></div><div class="doc"><div class="markdown"><p>Remaps the :f values that a nemesis accepts. Takes a function (presumably injective) which transforms <code>:f</code> values: <code>(lift f) -&gt; g</code>, and a nemesis which accepts operations like <code>{:f f}</code>. The nemesis must support Reflection/fs. Returns a new nemesis which takes <code>{:f g}</code> instead. For example:</p>
<p>(f-map (fn <a href="f">f</a> <a href=":foo f">:foo f</a>) (partition-random-halves))</p>
<p>… yields a nemesis which takes ops like <code>{:f [:foo :start] ...}</code> and calls the underlying partitioner nemesis with <code>{:f :start ...}</code>. This is designed for symmetry with generator/f-map, so you can say:</p>
<p>(gen/f-map lift gen) (nem/f-map lift gen)</p>
<p>and get a generator and nemesis that work together. Particularly handy for building up complex nemesis packages using nemesis.combined!</p>
<p>If you know all of your fs in advance, you can also do this with <code>compose</code>, but it turns out to be handy to have this as a separate function.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L303">view source</a></div></div><div class="public anchor" id="var-hammer-time"><h3>hammer-time</h3><div class="usage"><code>(hammer-time process)</code><code>(hammer-time targeter process)</code></div><div class="doc"><div class="markdown"><p>Responds to <code>{:f :start}</code> by pausing the given process name on a given node or nodes using SIGSTOP, and when <code>{:f :stop}</code> arrives, resumes it with SIGCONT.  Picks the node(s) to pause using <code>(targeter list-of-nodes)</code>, which defaults to <code>rand-nth</code>. Targeter may return either a single node or a collection of nodes.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L498">view source</a></div></div><div class="public anchor" id="var-invert-grudge"><h3>invert-grudge</h3><div class="usage"><code>(invert-grudge nodes conns)</code></div><div class="doc"><div class="markdown"><p>Takes a universe of nodes and a map of nodes to nodes they should be connected to, and returns a map of nodes to nodes they should NOT be connected to.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L135">view source</a></div></div><div class="public anchor" id="var-majorities-ring"><h3>majorities-ring</h3><div class="usage"><code>(majorities-ring nodes)</code></div><div class="doc"><div class="markdown"><p>A grudge in which every node can see a majority, but no node sees the <em>same</em> majority as any other. There are nice, exact solutions where the topology <em>does</em> look like a ring: these are possible for 4, 5, 6, 8, etc nodes. Seven, however, does <em>not</em> work so cleanly–some nodes must be connected to <em>more</em> than four others. We therefore offer two algorithms: one which provides an exact ring for 5-node clusters (generally common in Jepsen), and a stochastic one which doesn’t guarantee efficient ring structures, but works for larger clusters.</p>
<p>Wow this actually is <em>shockingly</em> complicated. Wonder if there’s a better way?</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L261">view source</a></div></div><div class="public anchor" id="var-majorities-ring-perfect"><h3>majorities-ring-perfect</h3><div class="usage"><code>(majorities-ring-perfect nodes)</code></div><div class="doc"><div class="markdown"><p>The perfect variant of majorities-ring, used for 5-node clusters.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L203">view source</a></div></div><div class="public anchor" id="var-majorities-ring-stochastic"><h3>majorities-ring-stochastic</h3><div class="usage"><code>(majorities-ring-stochastic nodes)</code></div><div class="doc"><div class="markdown"><p>The stochastic variant of majorities-ring, used for larger clusters.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L219">view source</a></div></div><div class="public anchor" id="var-Nemesis"><h3>Nemesis</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-invoke.21"><h3>invoke!</h3><div class="usage"><code>(invoke! this test op)</code></div><div class="doc"><div class="markdown"><p>Apply an operation to the nemesis, which alters the cluster.</p>
</div></div></div><div class="public anchor" id="var-setup.21"><h3>setup!</h3><div class="usage"><code>(setup! this test)</code></div><div class="doc"><div class="markdown"><p>Set up the nemesis to work with the cluster. Returns the nemesis ready to be invoked</p>
</div></div></div><div class="public anchor" id="var-teardown.21"><h3>teardown!</h3><div class="usage"><code>(teardown! this test)</code></div><div class="doc"><div class="markdown"><p>Tear down the nemesis when work is complete</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L12">view source</a></div></div><div class="public anchor" id="var-node-start-stopper"><h3>node-start-stopper</h3><div class="usage"><code>(node-start-stopper targeter start! stop!)</code></div><div class="doc"><div class="markdown"><p>Takes a targeting function which, given a list of nodes, returns a single node or collection of nodes to affect, and two functions <code>(start! test node)</code> invoked on nemesis start, and <code>(stop! test node)</code> invoked on nemesis stop. Returns a nemesis which responds to :start and :stop by running the start! and stop! fns on each of the given nodes. During <code>start!</code> and <code>stop!</code>, binds the <code>jepsen.control</code> session to the given node, so you can just call <code>(c/exec ...)</code>.</p>
<p>The targeter can take either (targeter test nodes) or, if that fails, (targeter nodes).</p>
<p>Re-selects a fresh node (or nodes) for each start–if targeter returns nil, skips the start. The return values from the start and stop fns will become the :values of the returned :info operations from the nemesis, e.g.:</p>
<pre><code>{:value {:n1 [:killed "java"]}}
</code></pre>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L453">view source</a></div></div><div class="public anchor" id="var-noop"><h3>noop</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Does nothing.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L41">view source</a></div></div><div class="public anchor" id="var-partition-halves"><h3>partition-halves</h3><div class="usage"><code>(partition-halves)</code></div><div class="doc"><div class="markdown"><p>Responds to a :start operation by cutting the network into two halves–first nodes together and in the smaller half–and a :stop operation by repairing the network.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L186">view source</a></div></div><div class="public anchor" id="var-partition-majorities-ring"><h3>partition-majorities-ring</h3><div class="usage"><code>(partition-majorities-ring)</code></div><div class="doc"><div class="markdown"><p>Every node can see a majority, but no node sees the <em>same</em> majority as any other. Randomly orders nodes into a ring.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L278">view source</a></div></div><div class="public anchor" id="var-partition-random-halves"><h3>partition-random-halves</h3><div class="usage"><code>(partition-random-halves)</code></div><div class="doc"><div class="markdown"><p>Cuts the network into randomly chosen halves.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L193">view source</a></div></div><div class="public anchor" id="var-partition-random-node"><h3>partition-random-node</h3><div class="usage"><code>(partition-random-node)</code></div><div class="doc"><div class="markdown"><p>Isolates a single node from the rest of the network.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L198">view source</a></div></div><div class="public anchor" id="var-partitioner"><h3>partitioner</h3><div class="usage"><code>(partitioner)</code><code>(partitioner grudge)</code></div><div class="doc"><div class="markdown"><p>Responds to a :start operation by cutting network links as defined by (grudge nodes), and responds to :stop by healing the network. The grudge to apply is either taken from the :value of a :start op, or if that is nil, by calling (grudge (:nodes test))</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L158">view source</a></div></div><div class="public anchor" id="var-Reflection"><h3>Reflection</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>Optional protocol for reflecting on nemeses.</p>
</div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-fs"><h3>fs</h3><div class="usage"><code>(fs this)</code></div><div class="doc"><div class="markdown"><p>What :f functions does this nemesis support? Returns a set. Helpful for composition.</p>
</div></div></div></div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L19">view source</a></div></div><div class="public anchor" id="var-set-time.21"><h3>set-time!</h3><div class="usage"><code>(set-time! t)</code></div><div class="doc"><div class="markdown"><p>Set the local node time in POSIX seconds.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L431">view source</a></div></div><div class="public anchor" id="var-split-one"><h3>split-one</h3><div class="usage"><code>(split-one coll)</code><code>(split-one loner coll)</code></div><div class="doc"><div class="markdown"><p>Split one node off from the rest</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L114">view source</a></div></div><div class="public anchor" id="var-timeout"><h3>timeout</h3><div class="usage"><code>(timeout timeout-ms nemesis)</code></div><div class="doc"><div class="markdown"><p>Sometimes nemeses are unreliable. If you wrap them in this nemesis, it’ll time out their operations with the given timeout, in milliseconds. Timed out operations have :value :timeout.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L93">view source</a></div></div><div class="public anchor" id="var-truncate-file"><h3>truncate-file</h3><div class="usage"><code>(truncate-file)</code></div><div class="doc"><div class="markdown"><p>A nemesis which responds to</p>
<pre><code class="language-clj">{:f     :truncate
 :value {"some-node" {:file "/path/to/file or /path/to/dir"
                      :drop 64}}}
</code></pre>
<p>where the value is a map of nodes to <code>{:file, :drop}</code> maps, on those nodes, drops the last <code>:drop</code> bytes from the given file, or a random file from the given directory.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L514">view source</a></div></div><div class="public anchor" id="var-validate"><h3>validate</h3><div class="usage"><code>(validate nemesis)</code></div><div class="doc"><div class="markdown"><p>Wraps a nemesis, validating that it constructs responses to setup and invoke correctly.</p>
</div></div><div class="src-link"><a href="https://github.com/jepsen-io/jepsen/blob/v0.3.6/jepsen/src/jepsen/nemesis.clj#L87">view source</a></div></div></div></body></html>